# Operations Runbook（运维运行手册）中文执行版

> 对应英文原文：[`docs/operations_runbook.md`](../operations_runbook.md)  
> 上一篇：[`docs/zh/Portfolio_Playbook_CN.md`](./Portfolio_Playbook_CN.md) ｜ 下一篇：[`docs/zh/S5_S7_Validation_Playbook_CN.md`](./S5_S7_Validation_Playbook_CN.md)

## 范围
覆盖 S1-S7 组合编排层的：启动、监控、事故响应、回滚。

## 1) 启动流程
### 启动前检查
1. 交易所连接/API 权限可用（交易、合约、资金费率端点）。
2. 策略配置和编排器配置语法正确。
3. 时钟同步（NTP 偏差 <1 秒）。
4. 确认会话档位：`conservative` / `balanced` / `aggressive`。
5. 确认 kill-switch 通道可用（Slack/Telegram/Webhook）。

### 启动顺序
1. 启动行情和交易对刷新。
2. 启动 S1-S7，先设为“暂停开仓”。
3. 启动 orchestrator。
4. 做一次健康检查：桶权重计算正常、风控阈值加载正常、执行守卫为绿色。
5. 分阶段放开：A阶段 S3/S4/S5/S6 -> B阶段 S1 -> C阶段 S2/S7（点差与波动满足再开）。

## 2) 在线监控
- 核心面板：权益曲线、日PnL、滚动回撤、策略/资产敞口、相关性、波动分层、成交质量。
- 报警阈值：日损失、滚动回撤、连亏数、超时率、滑点异常、funding 数据降级。
- 值班节奏：每小时看 breaker；每4小时看集中敞口；UTC日终导出运维报告。

## 3) 事故响应
- P1：硬亏损限制触发/API 中断/敞口失控/无法平仓。
- P2：回撤 breaker 长时间触发、相关性集中、滑点突增。
- P3：funding 数据偶发中断、超时略增。

标准流程：确认告警 -> 分类 -> P1/P2 全局停开仓 -> 盘点仓位与爆仓距离 -> 必要时降档位 -> 分类定位原因 -> 执行对应缓解 -> 稳定后分阶段恢复。

## 4) 回滚流程
触发条件：拒单 >60%（持续30分钟）、上限未执行、breaker 触发异常、编排器异常循环。

回滚步骤：
1. `ENTRY_HALT=true`
2. 切换到上一版配置
3. 仅重启 orchestrator
4. 冒烟测试（权重/上限/breaker）
5. 分阶段恢复开仓
6. 建事故单（diff + 时间戳 + 受影响币对）

## 5) 变更管理
- 所有阈值改动必须进版本库。
- 重大改动先模拟盘7天。
- 紧急 override 12小时自动过期。
- 周评审：breaker次数、拒单原因、集中风险、相关性节流净影响。

## 修正记录
- 英文文档未含命令行；本中文执行版保留原流程并补齐实际执行动作描述。

### 成功判定
- 启动后 30 分钟内：无解析错误、无陈旧行情告警、风险状态为 `NORMAL`、拒单率 <30%。

### 失败排查（最常见3项）
1. S1-S7 未按“先暂停开仓”启动，导致刚上线即拥挤下单。
2. 告警阈值未分 P1/P2/P3，值班处理优先级错误。
3. 回滚只改配置未做冒烟测试。

### 下一步动作
- 进入 S5/S7 验证手册，完成多窗口验证和压力测试。
